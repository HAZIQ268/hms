/* eslint-disable no-undef */
/* global ClassicEditor */

var innap = (function () {
  "use strict";

  var e = $(window).width();

  var t = function () {
    var e = $(window).height() - 206;
    $(".chatbox .msg_card_body").css("height", e);
  };

  return {
    init: function () {
      var n;

      if ($("#menu").length > 0) $("#menu").metisMenu();

      $(".metismenu > .mm-active").each(function () {
        if (!$(this).children("ul").length > 0)
          $(this).addClass("active-no-child");
      });

      $("#checkAll").on("change", function () {
        $("td input, .email-list .custom-checkbox input").prop("checked", $(this).prop("checked"));
      });

      $(".checkAll").on("change", function () {
        $(this).closest(".check-data").find(".form-check-input").prop("checked", $(this).prop("checked"));
      });

      $(".nav-control").on("click", function () {
        $("#main-wrapper").toggleClass("menu-toggle");
        $(".hamburger").toggleClass("is-active");
      });

      // Highlight active menu item
      (function () {
        var e = window.location;
        var t = $("ul#menu a").filter(function () {
          return this.href === e.href;
        }).addClass("mm-active").parent().addClass("mm-active");

        while (t.is("li")) {
          t = t.parent().addClass("mm-show").parent().addClass("mm-active");
        }
      })();

      $("ul#menu>li").on("click", function () {
        if ($("body").attr("data-sidebar-style") === "mini") {
          $(this).find("ul").stop();
        }
      });

      n = window.outerHeight;
      if ((n = window.outerHeight) > 0 ? n : screen.height) {
        $(".content-body").css("min-height", n + 60 + "px");
      }

      // Collapse, Expand, Close, Reload
      $('a[data-action="collapse"]').on("click", function (e) {
        e.preventDefault();
        $(this)
          .closest(".card")
          .find('[data-action="collapse"] i')
          .toggleClass("mdi-arrow-down mdi-arrow-up");
        $(this).closest(".card").children(".card-body").collapse("toggle");
      });

      $('a[data-action="expand"]').on("click", function (e) {
        e.preventDefault();
        $(this)
          .closest(".card")
          .find('[data-action="expand"] i')
          .toggleClass("icon-size-actual icon-size-fullscreen");
        $(this).closest(".card").toggleClass("card-fullscreen");
      });

      $('[data-action="close"]').on("click", function () {
        $(this).closest(".card").removeClass().slideUp("fast");
      });

      $('[data-action="reload"]').on("click", function () {
        var e = $(this);
        e.parents(".card").addClass("card-load");
        e.parents(".card").append('<div class="card-loader"><i class="ti-reload rotate-refresh"></i></div>');
        setTimeout(function () {
          e.parents(".card").children(".card-loader").remove();
          e.parents(".card").removeClass("card-load");
        }, 2000);
      });

      // Scroll behavior for fixed header
      (function () {
        const e = $(".header").innerHeight();
        $(window).scroll(function () {
          if (
            $("body").attr("data-layout") === "horizontal" &&
            $("body").attr("data-header-position") === "static" &&
            $("body").attr("data-sidebar-position") === "fixed"
          ) {
            $(this.window).scrollTop() >= e
              ? $(".deznav").addClass("fixed")
              : $(".deznav").removeClass("fixed");
          }
        });
      })();

      // Responsive menu
      if (e <= 991) {
        $(".menu-tabs .nav-link").on("click", function () {
          if ($(this).hasClass("open")) {
            $(this).removeClass("open");
            $(".fixed-content-box").removeClass("active");
            $(".hamburger").show();
          } else {
            $(".menu-tabs .nav-link").removeClass("open");
            $(this).addClass("open");
            $(".fixed-content-box").addClass("active");
            $(".hamburger").hide();
          }
        });

        $(".close-fixed-content").on("click", function () {
          $(".fixed-content-box").removeClass("active");
          $(".hamburger").removeClass("is-active");
          $("#main-wrapper").removeClass("menu-toggle");
          $(".hamburger").show();
        });
      }

      // Chat Box toggle
      $(".bell-link").on("click", function () {
        $(".chatbox").addClass("active");
      });
      $(".chatbox-close").on("click", function () {
        $(".chatbox").removeClass("active");
      });

      // Input +/-
      $(".btn-number").on("click", function (e) {
        e.preventDefault();
        var fieldName = $(this).attr("data-field");
        var type = $(this).attr("data-type");
        var t = $("input[name='" + fieldName + "']");
        var n = parseInt(t.val());
        if (isNaN(n)) t.val(0);
        else if (type === "minus") t.val(n - 1);
        else if (type === "plus") t.val(n + 1);
      });

      // Chat User Switch
      $(".dz-chat-user-box .dz-chat-user").on("click", function () {
        $(".dz-chat-user-box").addClass("d-none");
        $(".dz-chat-history-box").removeClass("d-none");
      });
      $(".dz-chat-history-back").on("click", function () {
        $(".dz-chat-user-box").removeClass("d-none");
        $(".dz-chat-history-box").addClass("d-none");
      });

      // Fullscreen Toggle
      $(".dz-fullscreen").on("click", function () {
        $(this).toggleClass("active");
        if (
          document.fullscreenElement ||
          document.webkitFullscreenElement ||
          document.mozFullScreenElement ||
          document.msFullscreenElement
        ) {
          if (document.exitFullscreen) document.exitFullscreen();
          else if (document.msExitFullscreen) document.msExitFullscreen();
          else if (document.mozCancelFullScreen) document.mozCancelFullScreen();
          else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
        } else {
          if (document.documentElement.requestFullscreen)
            document.documentElement.requestFullscreen();
          else if (document.documentElement.webkitRequestFullscreen)
            document.documentElement.webkitRequestFullscreen();
          else if (document.documentElement.mozRequestFullScreen)
            document.documentElement.mozRequestFullScreen();
          else if (document.documentElement.msRequestFullscreen)
            document.documentElement.msRequestFullscreen();
        }
      });

      // Password Show/Hide
      $(".show-pass").on("click", function () {
        $(this).toggleClass("active");
        var input = $("#dz-password");
        input.attr("type", input.attr("type") === "password" ? "text" : "password");
      });

      $(".heart").on("click", function () {
        $(this).toggleClass("heart-blast");
      });

      // Load More
      $(".dz-load-more").on("click", function (e) {
        e.preventDefault();
        $(this).append(' <i class="fas fa-sync-alt"></i>');
        var t = $(this).attr("rel");
        var n = $(this).attr("id");
        $.ajax({
          method: "POST",
          url: t,
          dataType: "html",
          success: function (e) {
            $("#" + n + "Content").append(e);
            $(".dz-load-more i").remove();
          },
        });
      });

      // Light Gallery
      if ($("#lightgallery").length > 0) {
        $("#lightgallery").lightGallery({
          loop: true,
          thumbnail: true,
          exThumbImage: "data-exthumbimage",
        });
      }

      // Custom File Input
      $(".custom-file-input").on("change", function () {
        var e = $(this).val().split("\\").pop();
        $(this).siblings(".custom-file-label").addClass("selected").html(e);
      });

      t();

      // DateTime Picker
      if ($("#datetimepicker1").length > 0) {
        $("#datetimepicker1").datetimepicker({ inline: true });
      }

      // CKEditor
      if ($("#ckeditor").length > 0) {
        ClassicEditor.create(document.querySelector("#ckeditor"), {})
          .then((e) => (window.editor = e))
          .catch((e) => console.error(e.stack));
      }
    },

    load: function () {
      setTimeout(function () {
        $("#preloader").remove();
        $("#main-wrapper").addClass("show");
      }, 800);

      if ($(".default-select").length > 0) $(".default-select").niceSelect();
    },

    resize: function () {
      t();
    },

    handleMenuPosition: function () {
      if (e > 1024) {
        $(".metismenu li").each(function () {
          if ($("ul", this).length > 0) {
            var o = $("ul:first", this).css("display", "block");
            var t = o.offset().left;
            var n = o.width();
            o.removeAttr("style");
            var a = $("body").width();
            var isRTL = $("html").hasClass("rtl");
            var i = isRTL ? t + n <= a : t > 0;
            i ? $(this).find("ul:first").removeClass("left") : $(this).find("ul:first").addClass("left");
          }
        });
      }
    },
  };
})();

$(document).ready(function () {
  $('[data-bs-toggle="popover"]').popover();
  innap.init();
});

$(window).on("load", function () {
  "use strict";
  innap.load();
  setTimeout(function () {
    innap.handleMenuPosition();
  }, 1000);
});

$(window).on("resize", function () {
  "use strict";
  innap.resize();
  setTimeout(function () {
    innap.handleMenuPosition();
  }, 1000);
});
